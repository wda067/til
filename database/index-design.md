# 인덱스 설계

## 카디널리티

- **카디널리티가 높다 (High Cardinality)**: 해당 컬럼에 중복되는 값이 거의 없다는 의미다.
- **카디널리티가 낮다 (Low Cardinality)**: 해당 컬럼의 값이 몇 종류 안되어 중복되는 값이 많다는 의미다
- 인덱스는 카디널리티가 높은, 즉 식별성이 좋은 컬럼에 생성할 때 효율적이다.

## 인덱스 후보

- `WHERE` 절에서 자주 사용되는 컬럼
- 외래키
- `ORDER BY` 절에서 자주 사용되는 컬럼

## 주의사항

### 저장 공간

- 인덱스는 원본 테이블과는 별개로, B-Tree 구조를 가진 물리적인 파일로 디스크에 저장된다.
- 인덱스는 어떻게 구성하는지에 따라 다르지만, 일반적으로 원본 테이블 크기의 약 10% 내외의 공간을 추가로 차지한다고 알려져 있다. 

### 쓰기 성능

- 인덱스의 가장 치명적인 단점이자, 반드시 이해해야 할 핵심 트레이드오프다.
- 데이터에 변경이 일어날 때마다, 데이터베이스는 원본 테이블뿐만 아니라 이와 관련된 모든 인덱스를 함께 수정해야 하기 때문이다.

### 미리 인덱스를 만들지 않는다.

- 사용하지 않는 인덱스는 저장 공간만 차지하고 쓰기 성능만 저하시키는 암적인 존재다.
- 느린 쿼리가 발견되었을 때, 그 쿼리를 개선하기 위한 목적
으로 생성해야 한다.

### 사용하지 않는 인덱스는 주기적으로 정리한다.

- 대부분의 데이터베이스는 특정 인덱스가 얼마나 사용되었는지 모니터링하는 기능을 제공한다. 
- 몇 달, 혹은 1년 이상 아무도 사용하지 않는 인덱스가 있다면, 과감하게 삭제하여 시스템 자원을 확보하고 쓰기 성능을 높여야 한다.

### 인덱스 컬럼은 가공하면 안된다.

- `WHERE` 절에서 인덱스가 적용된 컬럼을 함수로 감싸거나 계산을 하는 등 가공하게 되면 인덱스가 적용되지 않는다. 
- 인덱스는 가공되지 않은 원본 값을 기준으로 만들어지기 때문이다.
- `WHERE SUBSTRING(item_name, 1, 5) = '게이밍'`